<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

<body>

	<ui:composition template="template.xhtml">

		<ui:define name="titulo">
            Cadastro de Telas
        </ui:define>

		<ui:define name="content">
			<p:panel style="background-color: buttonface">
				<h:form id="form1">
					<p:panel header="Cadastro de Telas">
						<p:tabView widgetVar="tabTelas" id="guiaTelas"
							binding="#{MBTela.tabView}">
							<p:ajax event="tabChange" listener="#{MBTela.onTabChange}"
								update=":form1:guiaTelas" />
							<p:tab title="Consulta">
								<p:messages id="msgConsulta" showDetail="false">
									<p:effect type="pulsate" event="load" delay="100" />
								</p:messages>
								<p:panel id="consulta" style="margin-top:20px;"
									styleClass="semBorda">

									<p:inputText value="#{MBTela.textoBusca}"
										style="text-transform:uppercase" size="60" />

									<h:panelGrid id="pnlFiltroConsulta" columns="3"
										style="margin-top:10px;">

										<p:outputLabel value="Filtrar: " />
										<p:selectOneMenu value="#{MBTela.nroProjetoBusca}"
											filter="true" filterMatchMode="contains">
											<f:ajax event="change" listener="#{MBTela.buscarModulos}"
												render="pnlFiltroConsulta" />
											<f:selectItem itemValue=""
												itemLabel="Selecione um projeto..." />
											<f:selectItems value="#{MBTela.listaProjetos}" var="p"
												itemValue="#{p.nro}" itemLabel="#{p.nome}" />
										</p:selectOneMenu>
										<p:selectOneMenu id="comboModulosBusca"
											rendered="#{MBTela.nroProjetoBusca != '0'}"
											value="#{MBTela.nroModuloBusca}" filter="true"
											filterMatchMode="contains">
											<f:selectItem itemValue="" itemLabel="Selecione um módulo..." />
											<f:selectItems value="#{MBTela.listaModulos}" var="m"
												itemValue="#{m.nro}" itemLabel="#{m.nome}" />
										</p:selectOneMenu>
									</h:panelGrid>

									<h:panelGrid columns="4" style="margin-top:10px;">
										<p:commandButton value="Novo" actionListener="#{MBTela.novo}"
											update=":form1:guiaTelas" />
										<p:commandButton value="Buscar"
											actionListener="#{MBTela.testeDuplaChamada}"
											update="msgConsulta" />
									</h:panelGrid>
								</p:panel>

								<p:dataTable id="tabela" var="t" value=""
									style="margin-top: 20px;">
									<p:column headerText="Nome da Tela" style="text-align: center">
										<h:outputText value="" />
									</p:column>
									<p:column headerText="Nome do Módulo"
										style="text-align: center">
										<h:outputText value="" />
									</p:column>
									<p:column headerText="Nome do Projeto"
										style="text-align: center">
										<h:outputText value="" />
									</p:column>
									<p:column style="width:32px;text-align: center">
										<p:commandButton update=":form1" icon="ui-icon-plus"
											title="Ver Funções">
											<f:setPropertyActionListener value="#{t}" target="" />
										</p:commandButton>
									</p:column>
									<p:column style="width:32px;text-align: center">
										<p:commandButton update=":form1" icon="ui-icon-pencil"
											title="Editar Módulo">
											<f:setPropertyActionListener value="#{t}" target="" />
										</p:commandButton>
									</p:column>
									<p:column style="width:32px;text-align: center">
										<p:commandButton update=":form1" icon="ui-icon-trash"
											title="Excluir Módulo">
											<p:confirm header="Atenção!"
												message="Deseja realmente excluir o módulo?"
												icon="ui-icon-alert" />
											<f:setPropertyActionListener value="#{t}" target="" />
										</p:commandButton>
									</p:column>
								</p:dataTable>

							</p:tab>

							<p:tab title="Cadastro e Edição">
								<p:messages id="msgCadastro" showDetail="false">
									<p:effect type="pulsate" event="load" delay="100" />
								</p:messages>
								<p:panel id="cadastro"
									rendered="#{MBTela.activeTabIndex == '1'}"
									styleClass="semBorda">
									<p:panel rendered="#{MBTela.acoesDisponiveis.size() > 0}"
										styleClass="semBorda">
										<h:panelGrid columns="3">
											<p:outputLabel value="Nome: " />
											<p:inputText value="#{MBTela.tela.nome}"
												style="text-transform:uppercase" size="40" />
											<h:panelGrid id="pnlFiltroCadastro" columns="2">
												<p:selectOneMenu value="#{MBTela.nroProjetoBusca}"
													filter="true" filterMatchMode="contains">
													<f:ajax event="change" listener="#{MBTela.buscarModulos}"
														render="pnlFiltroCadastro" />
													<f:selectItem itemValue=""
														itemLabel="Selecione um projeto..." />
													<f:selectItems value="#{MBTela.listaProjetos}" var="p"
														itemValue="#{p.nro}" itemLabel="#{p.nome}" />
												</p:selectOneMenu>
												<p:selectOneMenu id="comboModulos"
													rendered="#{MBTela.nroProjetoBusca != '0'}"
													value="#{MBTela.tela.modulo.nro}" filter="true"
													filterMatchMode="contains">
													<f:selectItem itemValue="0"
														itemLabel="Selecione um módulo..." />
													<f:selectItems value="#{MBTela.listaModulos}" var="m"
														itemValue="#{m.nro}" itemLabel="#{m.nome}" />
												</p:selectOneMenu>
											</h:panelGrid>
										</h:panelGrid>
										<div align="center" style="margin-top: 20px;">
											<p:pickList id="pickListAcao" value="#{MBTela.acoes}"
												var="acao" itemValue="#{acao}" itemLabel="#{acao.nome}"
												showCheckbox="true" showSourceFilter="true"
												showTargetFilter="true" filterMatchMode="contains"
												converter="acaoConverter" addLabel="Adicionar"
												addAllLabel="Adicionar Todos" removeLabel="Remover"
												removeAllLabel="Remover Todos"
												style="margin-left: 20%;">

												<p:ajax event="transfer" listener="#{MBTela.onTransfer}"
													update=":form1:guiaTelas:msgCadastro totalAcoes" />

												<f:facet name="sourceCaption">Ações</f:facet>
												<f:facet name="targetCaption">Funções</f:facet>

												<p:column style="width:85%;">
													<h:outputText value="#{acao.nome}" />
												</p:column>
											</p:pickList>
											<p:panelGrid id="pngTotal" columns="2"
												style="margin-top: 20px;">
												<h:outputText value="Quantidade de ações selecionadas:"
													style="font-size: 16px; " />
												<h:outputText id="totalAcoes"
													value="#{MBTela.quantidadeAcoesSelecionadas}"
													style="font-weight: bold; font-size: 16px;" />
											</p:panelGrid>
										</div>

										<div align="center" style="margin-top: 20px;">
											<p:commandButton style="width: 150px" value="Salvar"
												actionListener="#{MBTela.validarSalvar}" process="@parent"
												update=":form1:guiaTelas:msgCadastro, :form1:guiaTelas" />
										</div>

									</p:panel>
								</p:panel>

								<p:panel style="background-color: buttonface"
									styleClass="semBorda"
									rendered="#{MBTela.acoesDisponiveis.size() == 0}">
									<h:outputLabel
										value="Não existem ações disponíveis para o cadastro das funções!"
										style="font-size: 16px; " />
								</p:panel>
							</p:tab>
						</p:tabView>
					</p:panel>
				</h:form>
			</p:panel>

			<p:dialog widgetVar="dlgConfirmacao">

			</p:dialog>
		</ui:define>

	</ui:composition>

</body>
</html>